\chapter{The Theory of Hereditarily Finite Sets}

\section{Language and axioms}

The first-order theory of HF is determined by the first-order language of HF and three axioms.
The language $\mathcal{L}$ has one binary relation symbol $\in$, one binary function symbol $\lhd$, and one constant symbol $\varnothing$.
Informally, i.e. given an $\mathcal{L}$-structure whose domain consists of sets,  $\in$ represents membership, $x \lhd y$ is the result of
enlarging the set $x$ by $y$ (think of $x \cup \{y\}$), and $\varnothing$ denotes the empty set.

The axioms are given by the following sentences.

\begin{axiom}
    \label{ax:empty_axiom}
    \lean{HF.empty}
    \leanok
    $\forall z (z=\varnothing \leftrightarrow \forall x(x \notin z))$.
\end {axiom}

\begin{axiom}
    \label{ax:enlarge_axiom}
    \lean{HF.enlarge}
    \leanok
    $\forall z (z=x \lhd y \leftrightarrow \forall u(u \in z \leftrightarrow u \in x \lor u=y))$.
\end {axiom}

\begin{axiom}
    \label{ax:induction_axiom}
    \lean{HF.induction}
    \leanok
    $(\alpha(\varnothing) \land \forall x \forall y[\alpha(x) \land \alpha(y) \rightarrow \alpha(x \lhd y)]) \rightarrow \forall x \alpha(x)$.
\end {axiom}

The assumption in Axiom 3 — the induction principle — is that $\alpha$ is an $\mathcal{L}$-formula
and that it contains a distinguished freely occuring variable which is quantified over.

\section{Basic results}

\begin{lemma}
    \label{lem:set_notin_empty+enlarge_iff+enlarge_empty}
    \lean{HF.set_notin_empty, HF.enlarge_iff, HF.enlarge_empty}
    \leanok
    \uses{ax:empty_axiom, ax:enlarge_axiom}
    \leavevmode
    \begin{enumerate}
        \item $\forall x (x\notin \varnothing)$.
        \item $\forall x \forall y \forall u (u \in x \lhd y \leftrightarrow u \in x \lor u=y)$.
        \item $\forall y \forall z (z\in \varnothing \lhd y \leftrightarrow z = y$).
    \end{enumerate}
\end{lemma}

\begin{proof}
    \leanok
    \leavevmode
    \begin{enumerate}
        \item Substitute $\varnothing$ in Axiom \ref{ax:empty_axiom}.
        \item Substitute $x \lhd y$ in Axiom \ref{ax:enlarge_axiom}.
        \item Substitute $\varnothing$ for $x$ in Lemma \ref{lem:set_notin_empty+enlarge_iff+enlarge_empty}.2 and use Lemma \ref{lem:set_notin_empty+enlarge_iff+enlarge_empty}.1.
    \end{enumerate}
\end{proof}

\begin{theorem}[Extensionality Property]
    \label{thm:exten_prop}
    \lean{HF.exten_prop}
    \leanok
    \uses{ax:empty_axiom, ax:enlarge_axiom, ax:induction_axiom, lem:set_notin_empty+enlarge_iff+enlarge_empty}
    $\forall x \forall z (x=z \leftrightarrow \forall u (u \in x \leftrightarrow u \in z))$.
\end{theorem}

\begin{proof}
    \leanok
    Pick $x$ and $z$ arbitrarily and let $\alpha (x)$ be the formula $x=z \leftrightarrow \forall u (u \in x \leftrightarrow u \in z)$.
    We apply Axiom \ref{ax:induction_axiom}.
    \begin{itemize}
        \item The base case — $\alpha (\varnothing)$ — follows directly from Lemma \ref{lem:set_notin_empty+enlarge_iff+enlarge_empty}.1 and Axiom \ref{ax:empty_axiom}.
        \item The induction step — $\forall y[\alpha(x) \land \alpha(y) \rightarrow \alpha(x \lhd y)]$ — 
        follows directly from Lemma \ref{lem:set_notin_empty+enlarge_iff+enlarge_empty}.2 and Axiom \ref{ax:enlarge_axiom}.
    \end{itemize}
\end{proof}

\begin{definition}
    \label{def:Single+Pair+OrdPair}
    \lean{HF.Single, HF.Pair, HF.OrdPair}
    \leanok
    Denote by $\{x\}$, $\{x,y\}$ and $\langle x,y\rangle$ the following \textit{terms}:
    \begin{enumerate}
        \item $\{x\} = \varnothing \lhd x$.
        \item $\{x,y\} = \{x\} \lhd y$.
        \item $\langle x,y\rangle = \{\{x\}, \{x,y\}\}$.
    \end{enumerate}
\end{definition}

\begin{lemma}
    \label{lem:single_iff+pair_iff+...+ordPair_equal}
    \lean{HF.single_iff, HF.pair_iff, HF.duplic_pair_eq_single, HF.ordPair_equal}
    \leanok
    \uses{lem:set_notin_empty+enlarge_iff+enlarge_empty, thm:exten_prop, def:Single+Pair+OrdPair}
    \leavevmode
    \begin{enumerate}
        \item $\forall x \forall u (u\in \{x\} \leftrightarrow u = x)$.
        \item $\forall x \forall y \forall u (u \in \{x,y\}\leftrightarrow u=x \lor u=y)$.
        \item $\forall x (\{x,x\} = \{x\})$.
        \item $\forall x \forall y \forall u \forall v (\langle x,y\rangle = \langle u,v\rangle \leftrightarrow x=u \land y=v)$.
    \end{enumerate}
\end{lemma}

\begin{proof}
    \leanok
    \leavevmode
    \begin{enumerate}
        \item This follows directly from Lemma \ref{lem:set_notin_empty+enlarge_iff+enlarge_empty}.3.
        \item This follows directly from Lemma \ref{lem:set_notin_empty+enlarge_iff+enlarge_empty}.2 and Lemma \ref{lem:single_iff+pair_iff+...+ordPair_equal}.1.
        \item This follows directly from Theorem \ref{thm:exten_prop}, Lemma \ref{lem:single_iff+pair_iff+...+ordPair_equal}.1 and Lemma \ref{lem:single_iff+pair_iff+...+ordPair_equal}.2.
        \item  The proof closely follows an analogous proof from ZF by \cite{enderton1977elements}.
        Pick $x,y,u$ and $v$ arbitrarily. The $\leftarrow$ direction is trivial.
        For the $\rightarrow$ direction, by the definition of ordered pairs, the hypothesis can be rewritten to
        \begin{equation*}
            \{\{x\}, \{x,y\}\} = \{\{u\}, \{u,v\}\}.
        \end{equation*}
        It follows that
        \begin{equation}
            \{x\} \in \{\{u\}, \{u,v\}\}\quad\text{and}\quad \{x,y\} \in \{\{u\}, \{u,v\}\}
        \end{equation}
        and similarly
        \begin{equation}
            \{u\} \in \{\{x\}, \{x,y\}\}\quad\text{ and }\quad \{u,v\} \in \{\{x\}, \{x,y\}\}.
        \end{equation}
        By Lemma \ref{lem:single_iff+pair_iff+...+ordPair_equal}.2, (2) can be rewritten to
        \begin{equation*}
            (\textbf{a})\quad\{u\}=\{x\}\quad\text{or}\quad (\textbf{b})\quad\{u\}=\{x,y\}
        \end{equation*}
        and
        \begin{equation*}
            (\textbf{c})\quad\{u,v\}=\{x\}\quad\text{or}\quad (\textbf{d})\quad\{u,v\}=\{x,y\}.
        \end{equation*}
        Note that, by Theorem \ref{thm:exten_prop}, Lemma \ref{lem:single_iff+pair_iff+...+ordPair_equal}.1 and Lemma \ref{lem:single_iff+pair_iff+...+ordPair_equal}.2,
        \begin{equation}
        \forall x \forall y \forall z (\{x,y\} = \{z\} \leftrightarrow x = y =z).
        \end{equation}
        Now, consider three cases:
        \begin{itemize}
            \item Suppose (\textbf{b}) holds. Then, by (3), $u=x=y$. By Lemma \ref{lem:single_iff+pair_iff+...+ordPair_equal}.3, it then follows that 
            (\textbf{d}) can be rewritten to $\{u,v\}=\{x\}$, implying (\textbf{c}) and (\textbf{d}) are equivalent.
            Thus, by (3), under (\textbf{b}), it must hold that $u=v=x=y$.
            \item Suppose (\textbf{c}) holds. Then, by (3), $u=v=x$. Note that, by (1) and Lemma \ref{lem:single_iff+pair_iff+...+ordPair_equal}.2, 
            either $\{x,y\}=\{u\}$ or $\{x,y\}=\{u,v\}$.  By Lemma \ref{lem:single_iff+pair_iff+...+ordPair_equal}.3, it follows that $\{u,v\}=\{u\}$ and 
            thus these two statements are equivalent. Thus, by (3), under (\textbf{c}), it must hold that $x=y=u=v$.
            \item Suppose (\textbf{a}) and (\textbf{d}) hold. From (\textbf{a}) we have $u=x$. 
            From (\textbf{d}) it follows that, by Lemma \ref{lem:single_iff+pair_iff+...+ordPair_equal}.2, $v=x$ or $v=y$. In the latter case, 
            $u=x\land v=y$. If $v=x$, then $u=v=x$, and case (\textbf{c}) holds by (3); this case has already been considered.
        \end{itemize}
    \end{enumerate}
\end{proof}

\begin{theorem}[Existence of the union of two sets]
    \label{thm:exists_union}
    \lean{HF.exists_union}
    \leanok
    \uses{ax:induction_axiom, lem:set_notin_empty+enlarge_iff+enlarge_empty}
    $\forall x \forall y \exists z \forall u (u \in z \leftrightarrow u \in x \lor u \in y)$.
\end{theorem}

\begin{proof}
    \leanok
    Pick $x$ and $y$ arbitrarily and let $\alpha (x)$ be the formula $\exists z \forall u (u \in z \leftrightarrow u \in x \lor u \in y)$.
    We apply Axiom \ref{ax:induction_axiom}.
    \begin{itemize}
        \item For the base case — $\alpha (\varnothing)$ — take $z=y$ and use Lemma \ref{lem:set_notin_empty+enlarge_iff+enlarge_empty}.1.
        \item For the induction step — $\forall w[\alpha(x) \land \alpha(w) \rightarrow \alpha(x \lhd w)]$ — 
        pick $w$ arbitrarily and assume $\alpha(x)$, i.e. the existence of $x \cup y$. By Lemma \ref{lem:set_notin_empty+enlarge_iff+enlarge_empty}.2, 
        $\alpha(x \lhd w)$ is equivalent to $\exists z \forall u (u \in z \leftrightarrow u \in x \lor u = w \lor u \in y)$.
        Then, take $z= (x \cup y) \lhd w$ and use Lemma \ref{lem:set_notin_empty+enlarge_iff+enlarge_empty}.2.
    \end{itemize}
\end{proof}

\begin{theorem}[Existence of the union of a set of sets]
    \label{thm:exists_unionOfSet}
    \lean{HF.exists_unionOfSet}
    \leanok
    \uses{ax:induction_axiom, lem:set_notin_empty+enlarge_iff+enlarge_empty, thm:exists_union}
    $\forall x \exists z \forall u (u \in z \leftrightarrow \exists (y\in x)[u \in y])$.
\end{theorem}

\begin{proof}
    \leanok
    Pick $x$ arbitrarily and let $\alpha (x)$ be the formula $\exists z \forall u (u \in z \leftrightarrow \exists (y\in x)[u \in y])$.
    We apply Axiom \ref{ax:induction_axiom}.
    \begin{itemize}
        \item For the base case — $\alpha (\varnothing)$ — take $z=\varnothing$ and use Lemma \ref{lem:set_notin_empty+enlarge_iff+enlarge_empty}.1.
        \item For the induction step — $\forall w[\alpha(x) \land \alpha(w) \rightarrow \alpha(x \lhd w)]$ — 
        pick $w$ arbitrarily and assume $\alpha(x)$, i.e. the existence of $\bigcup x$.
        We need to find $z$ such that
        \begin{equation*}
        \begin{split}
            u \in z & \leftrightarrow \exists (y \in x \lhd w)[u \in y]\\
            & \leftrightarrow \exists y[(y \in x \lor y = w) \land u \in y]\\
            & \leftrightarrow \exists(y \in x)[u \in y] \lor u \in w\\
            & \leftrightarrow u \in \bigcup x \lor u \in w,
        \end{split}
        \end{equation*}
        using Lemma \ref{lem:set_notin_empty+enlarge_iff+enlarge_empty}.2. Thus, take $z = (\bigcup x) \cup w$.
    \end{itemize}
\end{proof}

\begin{theorem}[Comprehension Scheme]
    \label{thm:comp_scheme}
    \lean{HF.comp_scheme}
    \leanok
    \uses{ax:induction_axiom, lem:set_notin_empty+enlarge_iff+enlarge_empty}
    $\forall x \exists z \forall u (u\in z \leftrightarrow (u \in x) \land \phi (u))$, for any $\mathcal{L}$-formula $\phi$ in which $z$ is not free.
\end{theorem}

\begin{proof}
    \leanok
    Pick $x$ arbitrarily and let $\alpha (x)$ be the formula $\exists z \forall u (u\in z \leftrightarrow (u \in x) \land \phi (u))$.
    We apply Axiom \ref{ax:induction_axiom}.
    \begin{itemize}
        \item For the base case — $\alpha (\varnothing)$ — take $z=\varnothing$ and use Lemma \ref{lem:set_notin_empty+enlarge_iff+enlarge_empty}.1.
        \item For the induction step — $\forall y[\alpha(x) \land \alpha(y) \rightarrow \alpha(x \lhd y)]$ — 
        pick $y$ arbitrarily and assume $\alpha(x)$, i.e. the existence of $ \{u \in x : \phi (u)\}$.
        We need to find $z$ such that
    \begin{equation*}
    \begin{split}
        u \in z & \leftrightarrow (u \in x \lhd y) \land \phi (u)\\
        & \leftrightarrow (u \in x \lor u = y) \land \phi (u),
    \end{split}
    \end{equation*}
    using Lemma \ref{lem:set_notin_empty+enlarge_iff+enlarge_empty}.2.
    Since $z$ is not free in $\phi$, take $z = \{u \in x : \phi (u)\} \lhd y$ if $\phi(y)$ 
    and $z=\{u \in x : \phi (u)\}$ if $\neg \phi(y)$.
    \end{itemize}
\end{proof}

\begin{definition}[Intersection]
    \label{def:Inter}
    \lean{HF.Inter, HF.InterSet}
    \leanok
    \uses{thm:exists_unionOfSet, thm:comp_scheme}
    Introduce the notation:
    \begin{enumerate}
        \item $x \cap y = \{u \in x : u \in y\}$.
        \item $\bigcap x = \{u \in \bigcup x : \forall (v \in x)[u \in v] \}$.
    \end{enumerate}  
\end{definition}

\begin{theorem}[Replacement Scheme]
    \label{thm:repl_scheme}
    \lean{HF.repl_scheme}
    \leanok
    \uses{ax:induction_axiom, lem:set_notin_empty+enlarge_iff+enlarge_empty}
    $$\forall x ([\forall (u \in x) [\exists! v] \psi (u,v)]\rightarrow \exists z \forall v [v\in z \leftrightarrow \exists(u \in x) \psi (u,v)]),$$ 
    for any $\mathcal{L}$-formula $\psi$ in which $z$ is not free.
\end{theorem}

\begin{proof}
    \leanok
    Pick $x$ arbitrarily and let $\alpha (x)$ be the formula $[\forall (u \in x) [\exists! v] \psi (u,v)]\rightarrow \exists z \forall v [v\in z \leftrightarrow \exists(u \in x) \psi (u,v)]$.
    We apply Axiom \ref{ax:induction_axiom}.
    \begin{itemize}
        \item For the base case — $\alpha (\varnothing)$ — take $z=\varnothing$ and use Lemma \ref{lem:set_notin_empty+enlarge_iff+enlarge_empty}.1.
        \item For the induction step — $\forall y[\alpha(x) \land \alpha(y) \rightarrow \alpha(x \lhd y)]$ — 
        pick $y$ arbitrarily and assume $\alpha(x)$, i.e. the existence of $\{v : \exists (u\in x)\psi(u,v)\}$ provided that $\forall (u \in x) [\exists! v] \psi (u,v)$.
        Furthermore, assume $\forall (u \in x \lhd y) [\exists! v] \psi (u,v)$, i.e. that $\forall u [(u \in x \lor u = y) \rightarrow \exists! v \psi (u,v)]$.
        Hence, $\exists! v \psi (y,v)$; let $v_y$ be this unique $v$. Moreover, it follows that $\forall (u \in x) [\exists! v] \psi (u,v)$ and thus $\{v : \exists (u\in x)\psi(u,v)\}$ exists.
        By Lemma \ref{lem:set_notin_empty+enlarge_iff+enlarge_empty}.2, the required $z$ is $\{v : \exists (u\in x)\psi(u,v)\} \lhd v_y$.
    \end{itemize}
\end{proof}

\begin{definition}[Subset relation]
    \label{def:SubsetEq+Subset}
    \lean{HF.SubsetEq, HF.Subset}
    \leanok
    Introduce the notation:
    \begin{enumerate}
        \item $y \subseteq x \leftrightarrow \forall v (v\in y \rightarrow v \in x)$.
        \item $y \subset x \leftrightarrow y \subseteq x \land y \neq x$.
    \end{enumerate}  
\end{definition}

\begin{theorem}[Existence of the power set]
    \label{thm:exists_powerSet}
    \lean{HF.exists_powerSet}
    \leanok
    \uses{ax:induction_axiom, lem:set_notin_empty+enlarge_iff+enlarge_empty, thm:exten_prop, def:Single+Pair+OrdPair, lem:single_iff+pair_iff+...+ordPair_equal, thm:exists_union, thm:repl_scheme, def:SubsetEq+Subset}
    $\forall x \exists z \forall u (u\in z \leftrightarrow u \subseteq x).$
\end{theorem}

\begin{proof}
    \leanok
    Pick $x$ arbitrarily and let $\alpha (x)$ be the formula $\exists z \forall u (u\in z \leftrightarrow u \subseteq x)$.
    We apply Axiom \ref{ax:induction_axiom}.
    \begin{itemize}
        \item For the base case — $\alpha (\varnothing)$ — take $z=\{\varnothing\}$ and use Lemma \ref{lem:set_notin_empty+enlarge_iff+enlarge_empty}, \ref{lem:single_iff+pair_iff+...+ordPair_equal}.1 
        and \ref{thm:exten_prop}.
        \item For the induction step — $\forall y[\alpha(x) \land \alpha(y) \rightarrow \alpha(x \lhd y)]$ — 
        pick $y$ arbitrarily and assume $\alpha(x)$, i.e. the existence of the power set $P(x)$.
        One checks directly from the definitions that $$u \subseteq x \lhd y \leftrightarrow u \in P(x) \lor \exists (v \in P(x))[u=v\lhd y]. $$
        Indeed, for the $\rightarrow$ direction, the cases $y \notin u$ and $y \in u$ correspond to the left and right cases of the disjunction, 
        respectively, where for the right case, the required $v$ is $u \cap x$. The $\leftarrow$ direction is rather trivial.
        Now, note that the formula $\psi(v,u): u = v \lhd y$ satisfies the condition for Theorem \ref{thm:repl_scheme}, i.e. $v \mapsto v \lhd y$ is a well-defined mapping.
        By Theorem \ref{thm:exists_union}, it follows that the required $z$ is $P(x) \cup \{u : \exists (v \in P(x)) [u=v\lhd y]\}$.
    \end{itemize}
\end{proof}

\begin{theorem}[Foundation Property]
    \label{thm:found_prop}
    \lean{HF.found_prop}
    \uses{ax:induction_axiom, lem:set_notin_empty+enlarge_iff+enlarge_empty, thm:exten_prop, def:Inter}
    $\forall z (z\neq \varnothing \rightarrow \exists (w \in z)[w\cap z = \varnothing])$.
\end{theorem}

\begin{proof}
    ...
\end{proof}

\begin{corollary}
    \label{cor:set_notin_itself}
    \lean{HF.set_notin_itself}
    \leanok
    \uses{lem:set_notin_empty+enlarge_iff+enlarge_empty, thm:exten_prop, def:Single+Pair+OrdPair, lem:single_iff+pair_iff+...+ordPair_equal, def:Inter, thm:found_prop}
    $\forall x (x \notin x)$.
\end{corollary}

\begin{proof}
    \leanok
    Apply the foundation property to $z = \{x\}\neq \varnothing$.
    It follows that $\exists (w \in \{x\})[w\cap \{x\} = \varnothing]$, which implies $x \cap \{x\} = \varnothing$.
\end{proof}



